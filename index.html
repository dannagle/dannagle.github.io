<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="DevSpace Speaker Chart by Dan Nagle">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css?v=2">

    <title>DevSpace Speaker Chart by Dan Nagle</title>

    <script type="text/javascript" src="jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="moment.js"></script>


    <script>
    var entityMap = {
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      '"': '&quot;',
      "'": '&#39;',
      "/": '&#x2F;'
    };

    function escapeHtml(string) {
      return String(string).replace(/[&<>"'\/]/g, function (s) {
        return entityMap[s];
      });
    }

    function sortByKeys(array, key1, key2) {
        return array.sort(function(a, b) {
            var x = a[key1]; var y = b[key1];
			if(x == y) {
				x = a[key2]; y = b[key2];
			}
            return ((x < y) ? -1 : ((x > y) ? 1 : 0));
        });
    }

    function bindAbstracts() {
        $(".abstract").click(function(){
            var data = $(this).attr("data-abstract");
            //console.log(data);
            $(this).parent().html(data);

            return false;



        });

    }

    function bindTags() {
        $(".talktag").click(function(){
            var tagval1 = $(this).attr("data-tagval1");
            var addhighlight = !$(this).hasClass("talktaghighlight");
            var tagvalcheck = $(this).attr("data-tagval1");
            if(addhighlight) {
                console.log("need to add highlight from " + tagvalcheck);
                $('*[data-tagval1="'+tagvalcheck+'"]').addClass("talktaghighlight");
            } else {
                console.log("need to remove highlight from " + tagvalcheck);
                $('*[data-tagval1="'+tagvalcheck+'"]').removeClass("talktaghighlight");
            }
            return false;
        });
    }

    $(document).ready(function(){
        $.getJSON( "session.json", function( data ) {
            for(var i=0; i<data.length; i++) {
                data[i].StartTime = data[i].TimeSlot.StartTime;
                if(data[i].StartTime !== null) {
                    data[i].DisplayDateTime = data[i].TimeSlot.DisplayDateTime;
                } else {
                    data[i].DisplayDateTime = "Unassigned";
                }
            }
            var items = sortByKeys(data, "StartTime", "Room");

            var lastTimeSlot = "asdfasdf";
            var rowbuilder = "";
            var extlink = ''
            var extlinkunicode = '&#x279A;'
            var extlinkimg =  '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAABi0lEQVRIS9WW33GDMAzGLWCAdBN6Ns8NG3SEdoNkgrQTpJ2g2aAjtO9g6hGyQRkAUE85zDnmnw3Xh/CKpB/6rE8GmOMjhNgi4pdjuB2mwCeRc/7BGHvyydGxXiBKWgrzBi2F9UBxHG+iKIqH5Kmq6qyUOrewT8bYo6uMF1Bb/ICIpP9mJLkMgiDNskwlSRI3TUODMRbbKwEECcOQkga7aDNWQagGCCGOiLibkGA15ALinP8aEigA2Od5/m2Dl8hl1iAQdrMOkP4HRHfUgaSUvSlc20nXhNnREGihQUn67ah0IyCayKukKe8g4nNRFCf7A6/OaAgkhHhBxIOLMTVEx5qwWZCjz5iGULxSqrRhsyC9OaZMbUIoTkp5bypAV4wTaApmQ2jDDB2BM8jYiTtEfGCMlQDwrn3HOf/Ra2w1aGog5mzi1dHtgWBk1815yP5xGTuj3vaeK2y/R8SjcZ+VUso7O8blPvLiAsBbnuf7HsjV+Y40Vdd1am6Gbnt7/DNMschTp6qqXocglPgH46wKvvBUSK4AAAAASUVORK5CYII=">';

            console.log(items);
            $.each( items, function( key, val ) {
                rowbuilder = "";
                if(lastTimeSlot != val.StartTime) {
                    rowbuilder = "<tr style='background:#384452'><td colspan='3'></td></tr>";
                }
                lastTimeSlot = (val.StartTime);
                rowbuilder += "<tr><td>";
                //rowbuilder += val.Id + "</td><td>";
                rowbuilder += "<a target='_blank' href='"+ "https://www.devspaceconf.com/speakers.html?id=" + val.Speaker.Id + "'>" + val.Speaker.DisplayName + "</a>";
                if(val.Room !== null) {
                    rowbuilder += "<br>"+ val.Room + "</td><td>";
                } else {
                    rowbuilder += "<br>Room: Unassigned</td><td>";
                }
                rowbuilder += "<a target='_blank' href='"+ "https://www.devspaceconf.com/sessions.html?id=" + val.Id + "'>" + val.Title + extlink + "<br><div><br><a data-abstract='"+escapeHtml(val.Abstract)+"' class='abstract' href='#'>View Abstract</a></div></td><td class='timeandtags'>";
                rowbuilder += val.DisplayDateTime + "<BR>";
				var tagbuilder = "";
				$.each( val.Tags, function( key1, val1 ) {
					tagbuilder += " <span class='talktag' data-tagval1='"+val1.Id+"'>" + val1.Text + "</span>";
				});
				rowbuilder += tagbuilder;
                rowbuilder += "</td></tr>"
                $("#speaktable").append(rowbuilder);
            });

             bindAbstracts();
             bindTags();

        });

    });

    </script>

  </head>

  <body>


    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <h3><a href="https://www.devspaceconf.com/">DevSpace</a> is October 12th (Fri) &amp; 13th(Sat), 2018</h3>
        <h4>API: <a href="https://www.devspaceconf.com/api/v1/session">www.devspaceconf.com/api/v1/session</a></h4>
        <table id="speaktable">
        </table>
    </div>

  </body>
</html>
